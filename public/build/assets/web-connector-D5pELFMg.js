const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/passkeys-DihKN4og.js","assets/app-DyNvxuMG.js"])))=>i.map(i=>d[i]);
import{y as O,z as m,A as y,g as F,C as G,a as B,D as V,p as x,E as C,_ as Q}from"./app-DyNvxuMG.js";import{a as J,U as g}from"./types-eLQXA00q.js";import{e as q}from"./eth_sendRawTransaction-DPdnXbFR.js";const H="/sdk/2022-08-12/embedded-wallet",b=i=>`thirdwebEwsWalletUserId-${i}`,K="walletToken",L=i=>`${K}-${i}`,k=i=>`passkey-credential-id-${i}`,Z="a",v=(i,e)=>`${Z}-${i}-${e}`,S=i=>`walletConnectSessions-${i}`,T=new Map;class f{constructor({storage:e,clientId:t,ecosystemId:a}){Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.storage=e,this.key=z(t,a)}async getItem(e){return this.storage?this.storage.getItem(e):T.get(e)??null}async setItem(e,t){if(this.storage)return this.storage.setItem(e,t);T.set(e,t)}async removeItem(e){const t=await this.getItem(e);return this.storage&&t?(this.storage.removeItem(e),!0):!1}async getWalletConnectSessions(){return this.getItem(S(this.key))}async saveWalletConnectSessions(e){await this.setItem(S(this.key),e)}async savePasskeyCredentialId(e){await this.setItem(k(this.key),e)}async getPasskeyCredentialId(){return this.getItem(k(this.key))}async saveAuthCookie(e){await this.setItem(L(this.key),e)}async getAuthCookie(){return this.getItem(L(this.key))}async removeAuthCookie(){return this.removeItem(L(this.key))}async saveDeviceShare(e,t){await this.saveWalletUserId(t),await this.setItem(v(this.key,t),e)}async getDeviceShare(){const e=await this.getWalletUserId();return e?this.getItem(v(this.key,e)):null}async removeDeviceShare(){const e=await this.getWalletUserId();return e?this.removeItem(v(this.key,e)):!1}async getWalletUserId(){return this.getItem(b(this.key))}async saveWalletUserId(e){await this.setItem(b(this.key),e)}async removeWalletUserId(){return this.removeItem(b(this.key))}}const z=(i,e)=>`${i}${e?`-${e}`:""}`;function X(i){let a=[`${i.domain} wants you to sign in with your Ethereum account:`,i.address].join(`
`);a=[a,i.statement].join(`

`),i.statement&&(a+=`
`);const n=[];if(i.uri){const u=`URI: ${i.uri}`;n.push(u)}const s=`Version: ${i.version}`;if(n.push(s),i.chain_id){const u=`Chain ID: ${i.chain_id}`||"1";n.push(u)}const r=`Nonce: ${i.nonce}`;n.push(r);const o=`Issued At: ${i.issued_at}`;n.push(o);const l=`Expiration Time: ${i.expiration_time}`;if(n.push(l),i.invalid_before){const u=`Not Before: ${i.invalid_before}`;n.push(u)}i.resources&&n.push(["Resources:",...i.resources.map(u=>`- ${u}`)].join(`
`));const p=n.join(`
`);return[a,p].join(`
`)}async function Y(i){const{payload:e,account:t}=i;return{signature:await t.signMessage({message:X(e)}),payload:e}}function D(){return`${m("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function $(i,e){return`${m("inAppWallet")}/api/2024-05-05/login/passkey?type=${i}${e?`&username=${e}`:""}`}async function ee(i){var c,d,h;if(!i.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const e=new f({storage:i.storage,clientId:i.client.clientId,ecosystemId:(c=i.ecosystem)==null?void 0:c.id}),t=O(i.client,i.ecosystem),a=i.username??ie(i.ecosystem),s=await(await t($("sign-up",a))).json();if(!s.challenge)throw new Error("No challenge received");const r=s.challenge,o=await i.passkeyClient.register({name:a,challenge:r,rp:i.rp}),l={};(d=i.ecosystem)!=null&&d.partnerId&&(l["x-ecosystem-partner-id"]=i.ecosystem.partnerId),(h=i.ecosystem)!=null&&h.id&&(l["x-ecosystem-id"]=i.ecosystem.id);const u=await(await t(D(),{method:"POST",headers:{"Content-Type":"application/json",...l},body:JSON.stringify({type:"sign-up",authenticatorData:o.authenticatorData,credentialId:o.credentialId,serverVerificationId:s.serverVerificationId,clientData:o.clientData,username:a,credential:{publicKey:o.credential.publicKey,algorithm:o.credential.algorithm},origin:o.origin,rpId:i.rp.id})})).json();if(!u||!u.storedToken)throw new Error(`Error verifying passkey: ${u.message??"unknown error"}`);return await e.savePasskeyCredentialId(o.credentialId),u}async function te(i){var c,d,h;if(!i.passkeyClient.isAvailable())throw new Error("Passkeys are not available on this device");const e=new f({storage:i.storage,clientId:i.client.clientId,ecosystemId:(c=i.ecosystem)==null?void 0:c.id}),t=O(i.client,i.ecosystem),n=await(await t($("sign-in"))).json();if(!n.challenge)throw new Error("No challenge received");const s=n.challenge,r=await e.getPasskeyCredentialId()??void 0,o=await i.passkeyClient.authenticate({credentialId:r,challenge:s,rp:i.rp}),l={};(d=i.ecosystem)!=null&&d.partnerId&&(l["x-ecosystem-partner-id"]=i.ecosystem.partnerId),(h=i.ecosystem)!=null&&h.id&&(l["x-ecosystem-id"]=i.ecosystem.id);const u=await(await t(D(),{method:"POST",headers:{"Content-Type":"application/json",...l},body:JSON.stringify({type:"sign-in",authenticatorData:o.authenticatorData,credentialId:o.credentialId,serverVerificationId:n.serverVerificationId,clientData:o.clientData,signature:o.signature,origin:o.origin,rpId:i.rp.id})})).json();if(!u||!u.storedToken)throw new Error(`Error verifying passkey: ${u.message??"unknown error"}`);return await e.savePasskeyCredentialId(o.credentialId),u}function ie(i){return`${(i==null?void 0:i.id)??"wallet"}-${new Date().toISOString()}`}const U=i=>{if(!J.includes(i)&&i!=="wallet")throw new Error(`Unknown auth option ${i}`);switch(i){case"wallet":return"siwe";default:return i}},I=({authOption:i,client:e,ecosystem:t,mode:a="popup",redirectUrl:n})=>{if(a==="popup"&&n)throw new Error("Redirect URL is not supported for popup mode");if(a==="window"&&!n)throw new Error("Redirect URL is required for window mode");const s=U(i);let r=`${m("inAppWallet")}/api/2024-05-05/login/${s}?clientId=${e.clientId}`;if(t!=null&&t.partnerId?r=`${r}&ecosystemId=${t.id}&ecosystemPartnerId=${t.partnerId}`:t&&(r=`${r}&ecosystemId=${t.id}`),a!=="popup"){const o=new URL(n||window.location.href);o.searchParams.set("walletId",(t==null?void 0:t.id)||"inApp"),o.searchParams.set("authProvider",i),r=`${r}&redirectUrl=${encodeURIComponent(o.toString())}`}return r},j=({authOption:i,client:e,ecosystem:t})=>{const a=U(i);let n=`${m("inAppWallet")}/api/2024-05-05/login/${a}/callback?clientId=${e.clientId}`;return t!=null&&t.partnerId?n=`${n}&ecosystemId=${t.id}&ecosystemPartnerId=${t.partnerId}`:t&&(n=`${n}&ecosystemId=${t.id}`),n};async function ae(i){const{wallet:e,chain:t}=i,a=await e.connect({client:i.client}),n=O(i.client,i.ecosystem),s=await(async()=>{const l=I({authOption:"wallet",client:i.client,ecosystem:i.ecosystem}),p=await n(`${l}&address=${a.address}&chainId=${t.id}`);if(!p.ok)throw new Error("Failed to generate SIWE login payload");return await p.json()})(),{signature:r}=await Y({payload:s,account:a});return await(async()=>{const l=j({authOption:"wallet",client:i.client,ecosystem:i.ecosystem}),p=await n(`${l}&signature=${r}&payload=${encodeURIComponent(s)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signature:r,payload:s})});if(!p.ok)throw new Error("Failed to verify SIWE signature");return await p.json()})()}function E(i){return new Promise(e=>{setTimeout(e,i*1e3)})}const ne={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none",pointerEvents:"all"},W=new Map;class re{constructor({link:e,baseUrl:t,iframeId:a,container:n=document.body,onIframeInitialize:s}){Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.iframeBaseUrl=t;let r=document.getElementById(a);const o=new URL(e);if(!r||r.src!==o.href){r=document.createElement("iframe");const l={...ne};Object.assign(r.style,l),r.setAttribute("id",a),r.setAttribute("fetchpriority","high"),n.appendChild(r),r.src=o.href;const p=u=>{if(u.data.eventType==="ewsIframeLoaded"){if(window.removeEventListener("message",p),!r){console.warn("thirdweb iFrame not found");return}this.onIframeLoadHandler(r,s)()}};window.addEventListener("message",p)}this.iframe=r}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{var r;const a=new MessageChannel,n=new Promise((o,l)=>{a.port1.onmessage=p=>{const{data:u}=p;a.port1.close(),u.success||l(new Error(u.error)),W.set(e.src,!0),t&&t(),o(!0)}});(r=e==null?void 0:e.contentWindow)==null||r.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await n}}async call({procedureName:e,params:t,showIframe:a=!1}){var r;for(;!W.get(this.iframe.src);)await E(this.POLLING_INTERVAL_SECONDS);a&&(this.iframe.style.display="block",await E(.005));const n=new MessageChannel,s=new Promise((o,l)=>{n.port1.onmessage=async p=>{const{data:u}=p;n.port1.close(),a&&(await E(.1),this.iframe.style.display="none"),u.success?o(u.data):l(new Error(u.error))}});return(r=this.iframe.contentWindow)==null||r.postMessage({eventType:e,data:t},this.iframeBaseUrl,[n.port2]),s}destroy(){W.delete(this.iframe.src)}}class se extends re{constructor({clientId:e,baseUrl:t,ecosystem:a}){super({iframeId:ce+((a==null?void 0:a.id)||""),link:oe({clientId:e,path:H,ecosystem:a,baseUrl:t}).href,baseUrl:t,container:document.body}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.clientId=e,this.ecosystem=a}async onIframeLoadedInitVariables(){var t,a,n;const e=new f({storage:y,clientId:this.clientId,ecosystemId:(t=this.ecosystem)==null?void 0:t.id});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId,partnerId:(a=this.ecosystem)==null?void 0:a.partnerId,ecosystemId:(n=this.ecosystem)==null?void 0:n.id}}}function oe({clientId:i,baseUrl:e,path:t,ecosystem:a,queryParams:n}){var r;const s=new URL(`${t}`,e);if(n)for(const o of Object.keys(n))s.searchParams.set(o,((r=n[o])==null?void 0:r.toString())||"");return s.searchParams.set("clientId",i),(a==null?void 0:a.partnerId)!==void 0&&s.searchParams.set("partnerId",a.partnerId),(a==null?void 0:a.id)!==void 0&&s.searchParams.set("ecosystemId",a.id),s}const ce="thirdweb-in-app-wallet-iframe";class le{constructor({baseUrl:e,querier:t,preLogin:a,postLogin:n,client:s,ecosystem:r}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e,this.LoginQuerier=t,this.preLogin=a,this.postLogin=n,this.client=s,this.ecosystem=r}async sendEmailLoginOtp({email:e}){return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:e}})}async sendSmsLoginOtp({phoneNumber:e}){return await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:e}})}}class ue extends le{async authenticateWithModal(){return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0})}async loginWithModal(){await this.preLogin();const e=await this.authenticateWithModal();return this.postLogin(e)}async authenticateWithIframe({email:e}){return this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:e},showIframe:!0})}async loginWithIframe({email:e}){await this.preLogin();const t=await this.authenticateWithIframe({email:e});return this.postLogin(t)}async authenticateWithCustomJwt({encryptionKey:e,jwt:t}){if(!e||e.length===0)throw new Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:e,jwt:t}})}async loginWithCustomJwt({encryptionKey:e,jwt:t}){if(!e||e.length===0)throw new Error("Encryption key is required for custom jwt auth");await this.preLogin();const a=await this.authenticateWithCustomJwt({encryptionKey:e,jwt:t});return this.postLogin(a)}async authenticateWithCustomAuthEndpoint({encryptionKey:e,payload:t}){return this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:e,payload:t}})}async loginWithCustomAuthEndpoint({encryptionKey:e,payload:t}){if(!e||e.length===0)throw new Error("Encryption key is required for custom auth");await this.preLogin();const a=await this.authenticateWithCustomAuthEndpoint({encryptionKey:e,payload:t});return this.postLogin(a)}async authenticateWithEmailOtp({email:e,otp:t,recoveryCode:a}){return this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:e,otp:t,recoveryCode:a}})}async loginWithEmailOtp({email:e,otp:t,recoveryCode:a}){const n=await this.authenticateWithEmailOtp({email:e,otp:t,recoveryCode:a});return this.postLogin(n)}async authenticateWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a}){return this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:e,otp:t,recoveryCode:a}})}async loginWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a}){const n=await this.authenticateWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a});return this.postLogin(n)}}class he{constructor({client:e,querier:t,onAuthSuccess:a,ecosystem:n,baseUrl:s}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.AuthQuerier=t,this.localStorage=new f({storage:y,clientId:e.clientId,ecosystemId:n==null?void 0:n.id}),this.onAuthSuccess=a,this.BaseLogin=new ue({postLogin:async r=>this.postLogin(r),preLogin:async()=>{await this.preLogin()},ecosystem:n,querier:t,client:e,baseUrl:s})}async preLogin(){await this.logout()}async postLogin({storedToken:e,walletDetails:t}){return e.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(e.cookieString),await this.onAuthSuccess({storedToken:e,walletDetails:t})}async loginWithAuthToken(e,t){await this.preLogin();const a=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(a)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(e){return this.BaseLogin.loginWithIframe(e)}async authenticateWithIframe(e){return this.BaseLogin.authenticateWithIframe(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async authenticateWithCustomJwt(e){return this.BaseLogin.authenticateWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async authenticateWithCustomAuthEndpoint(e){return this.BaseLogin.authenticateWithCustomAuthEndpoint(e)}async sendEmailLoginOtp({email:e}){return this.BaseLogin.sendEmailLoginOtp({email:e})}async sendSmsLoginOtp({phoneNumber:e}){return this.BaseLogin.sendSmsLoginOtp({phoneNumber:e})}async loginWithEmailOtp(e){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(e)}async authenticateWithEmailOtp(e){return this.BaseLogin.authenticateWithEmailOtp(e)}async loginWithSmsOtp(e){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(e)}async authenticateWithSmsOtp(e){return this.BaseLogin.authenticateWithSmsOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),a=await this.localStorage.removeWalletUserId();return{success:e||t||a}}}const de="width=350, height=500",P=({isWindowOpenedByFn:i,win:e,closeOpenedWindow:t})=>{i?e==null||e.close():e&&t?t(e):e&&e.close()},pe=i=>{const e=I({...i,mode:i.mode||"redirect"});i.mode==="redirect"?window.location.href=e:window.open(e)},we=async i=>{let e=i.openedWindow,t=!1;if(e||(e=window.open(I({...i,mode:"popup"}),`Login to ${i.authOption}`,de),t=!0),!e)throw new Error("Something went wrong opening pop-up");return await new Promise((n,s)=>{const r=window.setInterval(async()=>{e.closed&&(clearInterval(r),window.removeEventListener("message",o),s(new Error("User closed login window")))},1e3),o=async l=>{if(l.origin===m("inAppWallet")){if(typeof l.data!="object"){s(new Error("Invalid event data"));return}switch(l.data.eventType){case"oauthSuccessResult":{window.removeEventListener("message",o),clearInterval(r),P({isWindowOpenedByFn:t,win:e,closeOpenedWindow:i.closeOpenedWindow}),l.data.authResult&&n(l.data.authResult);break}case"oauthFailureResult":{window.removeEventListener("message",o),clearInterval(r),P({isWindowOpenedByFn:t,win:e,closeOpenedWindow:i.closeOpenedWindow}),s(new Error(l.data.errorString));break}}}};window.addEventListener("message",o)})},ge=async i=>{const{client:e,ecosystem:t}=i,a=I({client:e,ecosystem:t,authOption:i.strategy}),n={"Content-Type":"application/json","x-client-id":e.clientId};t!=null&&t.id&&(n["x-ecosystem-id"]=t.id),t!=null&&t.partnerId&&(n["x-ecosystem-partner-id"]=t.partnerId);const s=(()=>{switch(i.strategy){case"email":return{email:i.email};case"phone":return{phone:i.phoneNumber}}})(),r=await fetch(a,{method:"POST",headers:n,body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to send verification code");return await r.json()},N=async i=>{const{client:e,ecosystem:t}=i,a=j({authOption:i.strategy,client:i.client,ecosystem:i.ecosystem}),n={"Content-Type":"application/json","x-client-id":e.clientId};t!=null&&t.id&&(n["x-ecosystem-id"]=t.id),t!=null&&t.partnerId&&(n["x-ecosystem-partner-id"]=t.partnerId);const s=(()=>{switch(i.strategy){case"email":return{email:i.email,code:i.verificationCode};case"phone":return{phone:i.phoneNumber,code:i.verificationCode}}})(),r=await fetch(a,{method:"POST",headers:n,body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to verify verification code");return await r.json()},me=async(i,e)=>await(await fetch(`${m("inAppWallet")}/api/2024-05-05/ecosystem-wallet/${i}/partner/${e}`,{headers:{"x-ecosystem-id":i,"x-ecosystem-partner-id":e||""}})).json();class fe{constructor({client:e,ecosystem:t,querier:a}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.walletManagerQuerier=a,this.localStorage=new f({storage:y,clientId:e.clientId,ecosystemId:t==null?void 0:t.id})}async postWalletSetUp({deviceShareStored:e,walletAddress:t,isIframeStorageEnabled:a,walletUserId:n}){return a||await this.localStorage.saveDeviceShare(e,n),{walletAddress:t}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===g.LOGGED_IN_WALLET_INITIALIZED?{status:g.LOGGED_IN_WALLET_INITIALIZED,...e.user,account:await this.getAccount()}:e.status===g.LOGGED_IN_NEW_DEVICE?{status:g.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:e.status===g.LOGGED_IN_WALLET_UNINITIALIZED?{status:g.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async getAccount(){var l,p,u;const e=this.walletManagerQuerier,t=this.client,a=(l=this.ecosystem)==null?void 0:l.partnerId,n=!!this.ecosystem,s=(p=this.ecosystem)!=null&&p.partnerId?await me(this.ecosystem.id,(u=this.ecosystem)==null?void 0:u.partnerId):void 0,{address:r}=await e.call({procedureName:"getAddress",params:void 0}),o=async c=>{const d={to:c.to??void 0,data:c.data,value:c.value,gasLimit:c.gas,nonce:c.nonce,chainId:c.chainId};c.maxFeePerGas?(d.accessList=c.accessList,d.maxFeePerGas=c.maxFeePerGas,d.maxPriorityFeePerGas=c.maxPriorityFeePerGas,d.type=2):(d.gasPrice=c.gasPrice,d.type=0);const h=C().rpc,{signedTransaction:w}=await e.call({procedureName:"signTransaction",params:{transaction:d,chainId:c.chainId,partnerId:a,rpcEndpoint:`https://${c.chainId}.${h}`},showIframe:s!=null&&s.permissions.includes("FULL_CONTROL_V1")?!1:n});return w};return{address:F(r),async signTransaction(c){if(!c.chainId)throw new Error("chainId required in tx to sign");return o({...c,chainId:c.chainId})},async sendTransaction(c){const d=G({client:t,chain:B(c.chainId)}),h=await o(c);return{transactionHash:await q(d,h)}},async signMessage({message:c}){const d=typeof c=="string"?c:c.raw instanceof Uint8Array?c.raw:V(c.raw),{signedMessage:h}=await e.call({procedureName:"signMessage",params:{message:d,partnerId:a,chainId:1},showIframe:s!=null&&s.permissions.includes("FULL_CONTROL_V1")?!1:n});return h},async signTypedData(c){var _;console.log("signTypedData",c);const d=x(c);(_=d.types)!=null&&_.EIP712Domain&&(d.types.EIP712Domain=void 0);const h=d.domain,w=h==null?void 0:h.chainId,A={...h!=null&&h.verifyingContract?{verifyingContract:h==null?void 0:h.verifyingContract}:{},name:h==null?void 0:h.name,version:h==null?void 0:h.version};w&&(A.chainId=w);const R=C().rpc,{signedTypedData:M}=await e.call({procedureName:"signTypedDataV4",params:{domain:A,types:d.types,message:d.message,chainId:w||1,partnerId:a,rpcEndpoint:`https://${w}.${R}`},showIframe:s!=null&&s.permissions.includes("FULL_CONTROL_V1")?!1:n});return M}}}}class Ee{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&e.length===36}constructor({client:e,onAuthSuccess:t,ecosystem:a,passkeyDomain:n}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(e.clientId))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const s=m("inAppWallet");this.client=e,this.passkeyDomain=n,this.querier=new se({clientId:e.clientId,ecosystem:a,baseUrl:s}),this.wallet=new fe({client:e,ecosystem:a,querier:this.querier}),this.auth=new he({client:e,querier:this.querier,baseUrl:s,ecosystem:a,onAuthSuccess:async r=>(t==null||t(r),await this.wallet.postWalletSetUp({...r.walletDetails,walletUserId:r.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{partnerId:a==null?void 0:a.partnerId,ecosystemId:a==null?void 0:a.id,deviceShareStored:r.walletDetails.deviceShareStored,clientId:this.client.clientId,walletUserId:r.storedToken.authDetails.userWalletId,authCookie:r.storedToken.cookieString}}),{user:{status:g.LOGGED_IN_WALLET_INITIALIZED,authDetails:r.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:r.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}getAccount(){return this.wallet.getAccount()}async preAuthenticate(e){return ge({...e,client:this.wallet.client,ecosystem:this.wallet.ecosystem})}authenticateWithRedirect(e,t,a){pe({authOption:e,client:this.wallet.client,ecosystem:this.wallet.ecosystem,redirectUrl:a,mode:t})}async loginWithAuthToken(e){return this.auth.loginWithAuthToken(e)}async authenticate(e){const t=e.strategy;switch(t){case"email":return N({...e,client:this.wallet.client,ecosystem:this.wallet.ecosystem});case"phone":return N({...e,client:this.wallet.client,ecosystem:this.wallet.ecosystem});case"jwt":return this.auth.authenticateWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"passkey":return this.passkeyAuth(e);case"auth_endpoint":return this.auth.authenticateWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.authenticateWithIframe({email:e.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"farcaster":case"discord":return we({authOption:t,client:this.wallet.client,ecosystem:this.wallet.ecosystem,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow});case"wallet":return ae({ecosystem:this.wallet.ecosystem,client:this.wallet.client,wallet:e.wallet,chain:e.chain})}}async connect(e){const t=e.strategy;switch(t){case"jwt":return this.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return this.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.loginWithIframe({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{const a=await this.passkeyAuth(e);return this.loginWithAuthToken(a)}case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"discord":{const a=await this.authenticate(e);return this.auth.loginWithAuthToken(a)}default:ye(t)}}async logout(){return await this.auth.logout()}async passkeyAuth(e){const{PasskeyWebClient:t}=await Q(async()=>{const{PasskeyWebClient:s}=await import("./passkeys-DihKN4og.js");return{PasskeyWebClient:s}},__vite__mapDeps([0,1])),a=new t,n=y;return e.type==="sign-up"?ee({client:this.wallet.client,ecosystem:this.wallet.ecosystem,username:e.passkeyName,passkeyClient:a,storage:n,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title}}):te({client:this.wallet.client,ecosystem:this.wallet.ecosystem,passkeyClient:a,storage:n,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title}})}}function ye(i,e){throw new Error(`Invalid param: ${i}`)}export{Ee as InAppWebConnector};
